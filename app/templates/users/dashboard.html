{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom">
    <div class="d-flex align-items-center">
        <img src="{{ url_for('static', filename=config.LOGO_NAVBAR) }}" 
             alt="{{ config.APP_NAME }}" 
             class="dashboard-logo"
             onerror="this.style.display='none'">
        <div>
            <h2 class="mb-1">{{ config.APP_NAME }}</h2>
            <p class="text-muted mb-0">Panel de Control Principal</p>
        </div>
    </div>
    <div class="text-end">
        <span class="badge bg-success fs-6">Conectado como: {{ current_user.username }}</span>
        {% if current_user.is_superuser %}
            <span class="badge bg-warning ms-1">Superadmin</span>
        {% endif %}
    </div>
</div>

<!-- InformaciÃ³n rÃ¡pida del sistema -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary">
            <div class="card-body">
                <h5 class="card-title">ğŸ‘¥ Usuarios</h5>
                <p class="card-text">Total en sistema</p>
                <h3>{{ total_users }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success">
            <div class="card-body">
                <h5 class="card-title">ğŸ” Roles</h5>
                <p class="card-text">Roles definidos</p>
                <h3>{{ total_roles }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-info">
            <div class="card-body">
                <h5 class="card-title">ğŸ“Š Sistema</h5>
                <p class="card-text">MÃ³dulos activos</p>
                <h3>{{ active_modules }}/{{ total_modules }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-dark">
            <div class="card-body">
                <h5 class="card-title">âš¡ Estado</h5>
                <p class="card-text">Nivel de Permisos</p>
                <h3>
                    {% if current_user.is_superuser %}
                        ğŸ”“ Completo
                    {% elif active_modules == total_modules %}
                        âœ… Total
                    {% elif active_modules > total_modules // 2 %}
                        ğŸ“ˆ Alto
                    {% else %}
                        ğŸ” Limitado
                    {% endif %}
                </h3>
            </div>
        </div>
    </div>
</div>

<!-- MÃ³dulos del ERP -->
<h3 class="mb-3">MÃ³dulos Disponibles</h3>
<div class="row">
    <!-- MÃ³dulo de Usuarios -->
    {% if current_user.has_permission('users', 1) %}
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">ğŸ‘¥ Usuarios</h5>
            </div>
            <div class="card-body">
                <p class="card-text">GestiÃ³n de usuarios, roles y permisos del sistema</p>
                <div class="mb-2">
                    <small class="text-muted">Tu permiso: 
                        {% if current_user.has_permission('users', 2) %}
                            <span class="badge bg-success">Completo</span>
                        {% else %}
                            <span class="badge bg-info">Solo lectura</span>
                        {% endif %}
                    </small>
                </div>
                <div class="btn-group w-100" role="group">
                    <a href="{{ url_for('users.user_list') }}" class="btn btn-outline-primary btn-sm">Usuarios</a>
                    <a href="{{ url_for('users.role_list') }}" class="btn btn-outline-primary btn-sm">Roles</a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- MÃ³dulo de Materiales -->
    {% if current_user.has_permission('materials', 1) %}
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header bg-success text-white">
                <h5 class="card-title mb-0">ğŸ“¦ Materiales</h5>
            </div>
            <div class="card-body">
                <p class="card-text">GestiÃ³n de materiales y productos del inventario</p>
                <div class="mb-2">
                    <small class="text-muted">Tu permiso: 
                        {% if current_user.has_permission('materials', 2) %}
                            <span class="badge bg-success">Completo</span>
                        {% else %}
                            <span class="badge bg-info">Solo lectura</span>
                        {% endif %}
                    </small>
                </div>
                <a href="{{ url_for('materials.material_list') }}" class="btn btn-primary w-100">Acceder al MÃ³dulo</a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- MÃ³dulo de Inventario -->
    {% if current_user.has_permission('inventory', 1) %}
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0">ğŸ“Š Inventario</h5>
            </div>
            <div class="card-body">
                <p class="card-text">Control de stock, existencias y movimientos de inventario</p>
                <div class="mb-2">
                    <small class="text-muted">Tu permiso: 
                        {% if current_user.has_permission('inventory', 2) %}
                            <span class="badge bg-success">Completo</span>
                        {% else %}
                            <span class="badge bg-info">Solo lectura</span>
                        {% endif %}
                    </small>
                </div>
                <a href="#" class="btn btn-primary w-100">Acceder al MÃ³dulo</a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- MÃ³dulo de Clientes -->
    {% if current_user.has_permission('customers', 1) %}
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header bg-warning text-white">
                <h5 class="card-title mb-0">ğŸ‘¨â€ğŸ’¼ Clientes</h5>
            </div>
            <div class="card-body">
                <p class="card-text">GestiÃ³n de base de clientes, contactos y historial</p>
                <div class="mb-2">
                    <small class="text-muted">Tu permiso: 
                        {% if current_user.has_permission('customers', 2) %}
                            <span class="badge bg-success">Completo</span>
                        {% else %}
                            <span class="badge bg-info">Solo lectura</span>
                        {% endif %}
                    </small>
                </div>
                <a href="{{ url_for('customers.customer_list') }}" class="btn btn-primary w-100">Acceder al MÃ³dulo</a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- MÃ³dulo de Contabilidad -->
    {% if current_user.has_permission('accounting', 1) %}
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header bg-danger text-white">
                <h5 class="card-title mb-0">ğŸ’° Contabilidad</h5>
            </div>
            <div class="card-body">
                <p class="card-text">Sistema contable, facturaciÃ³n y estados financieros</p>
                <div class="mb-2">
                    <small class="text-muted">Tu permiso: 
                        {% if current_user.has_permission('accounting', 2) %}
                            <span class="badge bg-success">Completo</span>
                        {% else %}
                            <span class="badge bg-info">Solo lectura</span>
                        {% endif %}
                    </small>
                </div>
                <a href="#" class="btn btn-primary w-100">Acceder al MÃ³dulo</a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- MÃ³dulo de Proveedores -->
    {% if current_user.has_permission('suppliers', 1) %}
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header bg-secondary text-white">
                <h5 class="card-title mb-0">ğŸ¢ Proveedores</h5>
            </div>
            <div class="card-body">
                <p class="card-text">GestiÃ³n de proveedores, compras y relaciones comerciales</p>
                <div class="mb-2">
                    <small class="text-muted">Tu permiso: 
                        {% if current_user.has_permission('suppliers', 2) %}
                            <span class="badge bg-success">Completo</span>
                        {% else %}
                            <span class="badge bg-info">Solo lectura</span>
                        {% endif %}
                    </small>
                </div>
                <a href="{{ url_for('suppliers.supplier_list') }}" class="btn btn-primary w-100">Acceder al MÃ³dulo</a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- MÃ³dulo de Reportes -->
    {% if current_user.has_permission('reporting', 1) %}
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header bg-dark text-white">
                <h5 class="card-title mb-0">ğŸ“ˆ Reportes</h5>
            </div>
            <div class="card-body">
                <p class="card-text">GeneraciÃ³n de reportes, anÃ¡lisis y Business Intelligence</p>
                <div class="mb-2">
                    <small class="text-muted">Tu permiso: 
                        {% if current_user.has_permission('reporting', 2) %}
                            <span class="badge bg-success">Completo</span>
                        {% else %}
                            <span class="badge bg-info">Solo lectura</span>
                        {% endif %}
                    </small>
                </div>
                <a href="#" class="btn btn-primary w-100">Acceder al MÃ³dulo</a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- MÃ³dulo de Compras -->
    {% if current_user.has_permission('purchases', 1) %}
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">ğŸ›’ Compras</h5>
            </div>
            <div class="card-body">
                <p class="card-text">GestiÃ³n de Ã³rdenes de compra, cotizaciones y proveedores</p>
                <div class="mb-2">
                    <small class="text-muted">Tu permiso: 
                        {% if current_user.has_permission('purchases', 2) %}
                            <span class="badge bg-success">Completo</span>
                        {% else %}
                            <span class="badge bg-info">Solo lectura</span>
                        {% endif %}
                    </small>
                </div>
                <a href="#" class="btn btn-primary w-100">Acceder al MÃ³dulo</a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- MÃ³dulo de Ventas -->
    {% if current_user.has_permission('sales', 1) %}
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header bg-success text-white">
                <h5 class="card-title mb-0">ğŸ’³ Ventas</h5>
            </div>
            <div class="card-body">
                <p class="card-text">GestiÃ³n de ventas, pedidos, clientes y facturaciÃ³n</p>
                <div class="mb-2">
                    <small class="text-muted">Tu permiso: 
                        {% if current_user.has_permission('sales', 2) %}
                            <span class="badge bg-success">Completo</span>
                        {% else %}
                            <span class="badge bg-info">Solo lectura</span>
                        {% endif %}
                    </small>
                </div>
                <a href="#" class="btn btn-primary w-100">Acceder al MÃ³dulo</a>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Mensaje si no hay mÃ³dulos disponibles -->
{% if active_modules == 0 %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body text-center py-5">
                <i class="fas fa-lock fa-3x text-muted mb-3"></i>
                <h4>No tienes acceso a ningÃºn mÃ³dulo</h4>
                <p class="text-muted">Contacta al administrador del sistema para solicitar permisos.</p>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Resumen de permisos (opcional - puedes eliminar esta secciÃ³n si no la necesitas) -->
{% if active_modules > 0 %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">ğŸ“Š Resumen de tus Permisos</h5>
                <span class="badge bg-primary">{{ active_modules }}/{{ total_modules }} mÃ³dulos activos</span>
            </div>
            <div class="card-body">
                <div class="row">
                    {% set modules = [
                        ('users', 'ğŸ‘¥ Usuarios'),
                        ('materials', 'ğŸ“¦ Materiales'),
                        ('inventory', 'ğŸ“Š Inventario'),
                        ('customers', 'ğŸ‘¨â€ğŸ’¼ Clientes'),
                        ('accounting', 'ğŸ’° Contabilidad'),
                        ('suppliers', 'ğŸ¢ Proveedores'),
                        ('reporting', 'ğŸ“ˆ Reportes'),
                        ('purchases', 'ğŸ›’ Compras'),
                        ('sales', 'ğŸ’³ Ventas')
                    ] %}
                    
                    {% for module, name in modules %}
                    {% if current_user.has_permission(module, 1) %}
                    <div class="col-md-4 mb-2">
                        <div class="d-flex justify-content-between align-items-center p-2 bg-light rounded">
                            <span>{{ name }}</span>
                            <span>
                                {% if current_user.has_permission(module, 2) %}
                                    <span class="badge bg-success">Completo</span>
                                {% else %}
                                    <span class="badge bg-info">Solo lectura</span>
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}