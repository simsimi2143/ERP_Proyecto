{% extends "purchases/base.html" %}

{% block purchases_title %}Carga Masiva de Órdenes de Compra{% endblock %}

{% block purchases_actions %}
    <a href="{{ url_for('purchases.purchase_list') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Volver a Lista
    </a>
{% endblock %}

{% block purchases_content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-upload"></i> Carga Masiva de Órdenes de Compra
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h6><i class="fas fa-info-circle"></i> Instrucciones:</h6>
                    <ol class="mb-0">
                        <li>Descarga la plantilla CSV haciendo clic en el botón "Descargar Plantilla"</li>
                        <li>Llena la plantilla con los datos de las órdenes de compra</li>
                        <li>Sube el archivo CSV completado usando el formulario below</li>
                        <li>Revisa que los datos sean correctos antes de confirmar</li>
                    </ol>
                </div>

                <div class="text-center mb-4">
                    <a href="{{ url_for('purchases.download_template') }}" class="btn btn-success btn-lg">
                        <i class="fas fa-download"></i> Descargar Plantilla CSV
                    </a>
                </div>

                <div class="alert alert-warning">
                    <h6><i class="fas fa-exclamation-triangle"></i> Formato Requerido:</h6>
                    <ul class="mb-0">
                        <li><strong>ID_Orden_Compra:</strong> Identificador único (ej: OC-2024-001)</li>
                        <li><strong>ID_Proveedor:</strong> Proveedor existente en el sistema (obligatorio)</li>
                        <li><strong>Fecha_Emision:</strong> Fecha de emisión (YYYY-MM-DD)</li>
                        <li><strong>Fecha_Estimada_Entrega:</strong> Fecha estimada de entrega (YYYY-MM-DD)</li>
                        <li><strong>Estado:</strong> Pendiente, Aprobada, Enviada, Recibida, Cancelada</li>
                        <li><strong>Moneda:</strong> Moneda existente en el sistema (obligatorio)</li>
                        <li><strong>Notas:</strong> Notas adicionales (opcional)</li>
                    </ul>
                </div>

                <form method="POST" action="{{ url_for('purchases.process_bulk_upload') }}" enctype="multipart/form-data" id="uploadForm">
                    <div class="mb-3">
                        <label for="csv_file" class="form-label">Seleccionar archivo CSV</label>
                        <input class="form-control" type="file" id="csv_file" name="csv_file" 
                               accept=".csv" required>
                        <div class="form-text">Solo archivos CSV con el formato correcto</div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary" disabled id="uploadBtn">
                            <i class="fas fa-upload"></i> Procesar Carga Masiva
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-table"></i> Vista Previa Plantilla
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>ID_Orden_Compra</th>
                                <th>ID_Proveedor</th>
                                <th>Fecha_Emision</th>
                                <th>Fecha_Estimada_Entrega</th>
                                <th>Estado</th>
                                <th>Moneda</th>
                                <th>Notas</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>OC-2024-001</td>
                                <td>PROV-001</td>
                                <td>2024-01-15</td>
                                <td>2024-02-01</td>
                                <td>Pendiente</td>
                                <td>MXN</td>
                                <td>Notas de ejemplo</td>
                            </tr>
                            <tr>
                                <td>OC-2024-002</td>
                                <td>PROV-002</td>
                                <td>2024-01-16</td>
                                <td>2024-02-05</td>
                                <td>Aprobada</td>
                                <td>USD</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('csv_file');
    const uploadBtn = document.getElementById('uploadBtn');
    
    fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
            uploadBtn.disabled = false;
        } else {
            uploadBtn.disabled = true;
        }
    });
});
</script>
{% endblock %}